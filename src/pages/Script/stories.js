document.addEventListener('DOMContentLoaded', function() {
    const storiesGrid = document.getElementById('stories-grid');
    
    const stories = [
        {
            title: "أمانة النبي ﷺ قبل البعثة",
            summary: "قصة أمانة النبي محمد ﷺ في حل نزاع وضع الحجر الأسود",
            content: `
                <h4>القصة:</h4>
                <p>قبل البعثة، اشتهر النبي ﷺ بالصادق الأمين. عندما أرادت قريش تجديد بناء الكعبة، اختلفوا في من يضع الحجر الأسود، فاتفقوا على أن يحكم بينهم أول داخل من الباب، فكان محمد ﷺ، فأمر بوضع الحجر على ثوب، وحمله زعماء القبائل معاً، ثم وضعه بيديه الشريفتين، فحل المشكلة بإنصاف.</p>
                
                <h4>العبرة:</h4>
                <p>الأمانة من صفات الأنبياء وهي أساس التعامل بين الناس، وهي من أعظم الأخلاق التي يتحلى بها المؤمن.</p>
                
                <h4>المراجع:</h4>
                <p>سيرة ابن هشام، البداية والنهاية لابن كثير</p>
            `,
            lessons: ["الأمانة", "العدل", "الحكمة"],
            category: "قصص الأنبياء",
            references: [
                { source: "سيرة ابن هشام", ref: "ج1 ص200-210" },
                { source: "البداية والنهاية", ref: "ج2 ص350-360" }
            ]
        },
        {
            title: "صبر النبي ﷺ على الأذى",
            summary: "قصة صبر النبي على إيذاء المشركين وهو ساجد عند الكعبة",
            content: `
                <h4>القصة:</h4>
                <p>في بداية الدعوة، كان المشركون يؤذون النبي ﷺ أشد الإيذاء. ذات يوم وهو يصلي عند الكعبة، ألقى عقبة بن أبي معيط سلا جزور (أمعاء الجمل) على ظهره وهو ساجد، فظل ﷺ ساجداً حتى جاءت فاطمة ابنته وأزالت الأذى عنه. وعندما سألوه عن سبب صبره، قال: 'كان الله يراني'.</p>
                
                <h4>العبرة:</h4>
                <p>الصبر على الأذى في سبيل الله من علامات قوة الإيمان، والله مع الصابرين وينصرهم.</p>
                
                <h4>المراجع:</h4>
                <p>صحيح البخاري، سيرة ابن هشام</p>
            `,
            lessons: ["الصبر", "الثبات", "التوكل"],
            category: "قصص الأنبياء",
            references: [
                { source: "صحيح البخاري", ref: "كتاب الصلاة، حديث 240" },
                { source: "سيرة ابن هشام", ref: "ج1 ص380-390" }
            ]
        },
        {
            title: "قصة الراعي الأمين",
            summary: "قصة الراعي الذي فضل الخوف من الله على الكذب لسيده",
            content: `
                <h4>القصة:</h4>
                <p>رأى النبي ﷺ راعياً يرعى غنمًا لسيده، فاختبره قائلاً: 'بعني شاة من هذه الغنم'، فقال الراعي: 'ليست لي، هي لسيدي'، فقال النبي: 'قل له أكلها الذئب'، فرد الراعي: 'فأين الله؟'. ضحك النبي ﷺ ثم اشتراه وأعتقه، وقال: 'لقد أعتق الله بدنك كما أعتقت لسانك'.</p>
                
                <h4>العبرة:</h4>
                <p>الصدق والأمانة من أعظم الأخلاق الإسلامية، والخوف من الله يمنع المؤمن من المعاصي.</p>
                
                <h4>المراجع:</h4>
                <p>سنن الترمذي، مسند أحمد</p>
            `,
            lessons: ["الصدق", "الأمانة", "الخوف من الله"],
            category: "قصص الصحابة",
            references: [
                { source: "سنن الترمذي", ref: "كتاب البر والصلة، حديث 1933" },
                { source: "مسند أحمد", ref: "ج3 ص450" }
            ]
        },
        {
            title: "توبة كعب بن مالك",
            summary: "قصة توبة كعب بن مالك ومن معه بعد تخلفهم عن غزوة تبوك",
            content: `
                <h4>القصة:</h4>
                <p>تخلف كعب بن مالك عن غزوة تبوك دون عذر، فلما عاد النبي ﷺ، أمر بمقاطعة كعب وصاحبيه، فظلوا خمسين ليلة لا يكلمهم أحد، حتى نزلت توبتهم في القرآن. يقول كعب: 'لما بلغني أن الله تاب عليّ، ذهبت إلى النبي ﷺ وهو يتهلل وجهه، فقال: أبشر بخير يوم مر عليك منذ ولدتك أمك'.</p>
                
                <h4>العبرة:</h4>
                <p>التوبة النصوح تغفر الذنوب ولو عظمت، والله يقبل توبة التائبين ويفرح بها.</p>
                
                <h4>المراجع:</h4>
                <p>صحيح البخاري، صحيح مسلم</p>
            `,
            lessons: ["التوبة", "الصبر", "الصدق"],
            category: "قصص الصحابة",
            references: [
                { source: "صحيح البخاري", ref: "كتاب المغازي، حديث 4156" },
                { source: "صحيح مسلم", ref: "كتاب التوبة، حديث 2769" }
            ]
        },
        {
            title: "قصة الصحابي الذي استقال من عمله",
            summary: "قصة الصحابي الذي ترك عمله في جباية الزكاة خوفاً من الله",
            content: `
                <h4>القصة:</h4>
                <p>كان أحد الصحابة يعمل في جباية الزكاة، فلما جمع الأموال قال: 'هذا مال المسلمين، إن أخذت منه شيئاً بغير حق كنت من اللصوص'. فترك العمل ورفض أن يأخذ أي أجر، وقال: 'أعمل لآخرتي ولا أريد شيئاً من الدنيا'.</p>
                
                <h4>العبرة:</h4>
                <p>الورع عن الحرام من علامات التقوى، والمؤمن الحقيقي يخاف من محاسبة الله في كل صغيرة وكبيرة.</p>
                
                <h4>المراجع:</h4>
                <p>حياة الصحابة للكاندهلوي، سير أعلام النبلاء</p>
            `,
            lessons: ["الورع", "التقوى", "الزهد"],
            category: "قصص الصحابة",
            references: [
                { source: "حياة الصحابة", ref: "ج2 ص150-160" },
                { source: "سير أعلام النبلاء", ref: "ج3 ص200-210" }
            ]
        },
        {
            title: "قصة المرأة التي تصدقت بخاتمها",
            summary: "قصة المرأة التي تصدقت بخاتمها الذهبي فنزلت فيها آية",
            content: `
                <h4>القصة:</h4>
                <p>تصدقت امرأة بخاتمها الذهبي في سبيل الله، فعاتبها بعض الناس وقالوا: 'لمن تتصدقين بهذا الخاتم الثمين؟' فأجابت: 'لله الذي لا تضيع عنده الأشياء'. فنزلت آية في القرآن تمدح فعلها: (وَمَن يَتَوَكَّلْ عَلَى اللَّهِ فَهُوَ حَسْبُهُ).</p>
                
                <h4>العبرة:</h4>
                <p>الصدقة من أحب الأعمال إلى الله، والإنفاق في سبيل الله سبب للبركة وزيادة الرزق.</p>
                
                <h4>المراجع:</h4>
                <p>تفسير ابن كثير، تفسير الطبري</p>
            `,
            lessons: ["الكرم", "التوكل", "الصدقة"],
            category: "قصص الصحابيات",
            references: [
                { source: "تفسير ابن كثير", ref: "سورة الطلاق، آية 3" },
                { source: "تفسير الطبري", ref: "ج28 ص150-160" }
            ]
        },
        {
            title: "كرم حاتم الطائي قبل الإسلام",
            summary: "قصة كرم حاتم الطائي الذي ضرب به المثل في الجود",
            content: `
                <h4>القصة:</h4>
                <p>كان حاتم الطائي مضرب المثل في الكرم قبل الإسلام. ذات مرة نزل به ضيف في ليلة شديدة البرودة، فلم يجد ما يضيفه به إلا فرسه، فذبحها له. وعندما أسلمت ابنته وذكرت كرمه أمام النبي ﷺ، قال: "إن الكرم من الإيمان".</p>
                
                <h4>العبرة:</h4>
                <p>الكرم من صفات المؤمن الحقيقي، وهو خلق عظيم يقرب إلى الله ويرفع صاحبه في الدنيا والآخرة.</p>
                
                <h4>المراجع:</h4>
                <p>الأغاني للأصفهاني، العقد الفريد لابن عبد ربه</p>
            `,
            lessons: ["الكرم", "الضيافة", "الإيثار"],
            category: "قصص العرب قبل الإسلام",
            references: [
                { source: "الأغاني للأصفهاني", ref: "ج17 ص120-125" },
                { source: "العقد الفريد", ref: "ج3 ص250-255" }
            ]
        },
        {
            title: "تواضع عمر بن الخطاب",
            summary: "قصة تواضع الخليفة عمر بن الخطاب مع الرعية",
            content: `
                <h4>القصة:</h4>
                <p>ذات ليلة كان عمر بن الخطاب يتفقد أحوال الرعية، فسمع امرأة تقول لابنتها: "اخففي اللبن بالماء" فقالت البنت: "أما سمعت ما أمر به أمير المؤمنين اليوم؟" فقالت الأم: "وما عمر بيننا الآن" فقالت البنت: "إن كان عمر لا يرانا، فإن رب عمر يرانا". فبكى عمر وأمر بإعطائها مالاً.</p>
                
                <h4>العبرة:</h4>
                <p>التواضع من صفات العظماء، والمراقبة لله في السر والعلن من أساسيات الإيمان.</p>
                
                <h4>المراجع:</h4>
                <p>سير أعلام النبلاء للذهبي، عمر بن الخطاب لابن الجوزي</p>
            `,
            lessons: ["التواضع", "المراقبة", "العدل"],
            category: "قصص الصحابة",
            references: [
                { source: "سير أعلام النبلاء", ref: "ج1 ص40-45" },
                { source: "عمر بن الخطاب", ref: "لابن الجوزي ص150" }
            ]
        },
        {
            title: "صبر أيوب عليه السلام",
            summary: "قصة ابتلاء النبي أيوب وصبره الجميل",
            content: `
                <h4>القصة:</h4>
                <p>ابتلي أيوب عليه السلام في بدنه وماله وأهله، فصبر واحتسب حتى أصبح مضرب المثل في الصبر. ظل سنوات يعاني من المرض الشديد حتى تنكر له الجميع إلا زوجته الوفية. فلما اشتد بلاؤه دعا ربه: "أَنِّي مَسَّنِيَ الضُّرُّ وَأَنتَ أَرْحَمُ الرَّاحِمِينَ" فاستجاب الله له وشفاه.</p>
                
                <h4>العبرة:</h4>
                <p>الصبر على البلاء من أعظم العبادات، والله مع الصابرين ويجزل لهم المثوبة.</p>
                
                <h4>المراجع:</h4>
                <p>القرآن الكريم (سورة الأنبياء، ص)، قصص الأنبياء لابن كثير</p>
            `,
            lessons: ["الصبر", "الثبات", "الدعاء"],
            category: "قصص الأنبياء",
            references: [
                { source: "القرآن الكريم", ref: "سورة الأنبياء: 83-84" },
                { source: "قصص الأنبياء", ref: "لابن كثير ص350-360" }
            ]
        },
        {
            title: "وفاء السيدة خديجة رضي الله عنها",
            summary: "قصة وفاء زوجة النبي ﷺ الأولى ومواساتها له",
            content: `
                <h4>القصة:</h4>
                <p>عندما نزل الوحي على النبي ﷺ أول مرة، رجع إلى خديجة وهو يرتجف قائلاً: "زملوني زملوني"، فلم تتردد في مواساته وتصديقه قائلة: "كلا والله لا يخزيك الله أبداً، إنك لتصل الرحم، وتحمل الكل، وتعين على نوائب الحق". وكانت أول من آمن به وواسته بمالها ونفسها.</p>
                
                <h4>العبرة:</h4>
                <p>الوفاء في العلاقات الزوجية من أعظم الأخلاق، والزوجة الصالحة هي خير معين على طاعة الله.</p>
                
                <h4>المراجع:</h4>
                <p>صحيح البخاري، السيرة النبوية لابن هشام</p>
            `,
            lessons: ["الوفاء", "الزواج", "الدعم"],
            category: "قصص الصحابيات",
            references: [
                { source: "صحيح البخاري", ref: "كتاب بدء الوحي، حديث 3" },
                { source: "السيرة النبوية", ref: "لابن هشام ج1 ص250" }
            ]
        },
        {
            title: "رحمة النبي ﷺ بالطفل",
            summary: "قصة بكاء الطفل عند رؤية النبي ﷺ ورفقه به",
            content: `
                <h4>القصة:</h4>
                <p>رأى النبي ﷺ طفلاً يبكي، فجلس بجانبه ومسح على رأسه وقال: "ما يبكيك يا غلام؟" فقال الطفل: "أبي مات ولم يعد يأتي لي بالطعام". فبكى النبي ﷺ ثم أخذ بيده إلى بيته وأطعمه وكساه وقال لأصحابه: "من يكفل هذا اليتيم يكون معي في الجنة هكذا" وأشار بإصبعيه المسبحة والوسطى.</p>
                
                <h4>العبرة:</h4>
                <p>الرحمة بالصغار واليتامى من أخلاق النبي ﷺ، وهي طريق إلى الجنة.</p>
                
                <h4>المراجع:</h4>
                <p>سنن أبي داود، مسند أحمد</p>
            `,
            lessons: ["الرحمة", "كفالة اليتيم", "الرفق"],
            category: "قصص النبي ﷺ",
            references: [
                { source: "سنن أبي داود", ref: "كتاب الأدب، حديث 4943" },
                { source: "مسند أحمد", ref: "ج5 ص250" }
            ]
        },
        {
            title: "أمانة التاجر المسلم",
            summary: "قصة تاجر يرد الزيادة في المال بعد سنوات",
            content: `
                <h4>القصة:</h4>
                <p>جاء رجل إلى تاجر مسلم وقال له: "منذ عشر سنوات بعتك بضاعة وزدت عليك في الثمن درهماً، وهذا مالك". فتعجب التاجر وقال: "وكيف تذكرت هذا بعد كل هذه السنين؟" فقال الرجل: "ذكرت ذلك وأنا أحاسب نفسي قبل أن أحاسب يوم القيامة". فقبل التاجر المال وقال: "هذا هو الدين الحق".</p>
                
                <h4>العبرة:</h4>
                <p>الأمانة في المعاملات من أساسيات الدين، والمؤمن يحاسب نفسه قبل أن يحاسب.</p>
                
                <h4>المراجع:</h4>
                <p>حلية الأولياء لأبي نعيم، إحياء علوم الدين للغزالي</p>
            `,
            lessons: ["الأمانة", "المحاسبة", "التجارة"],
            category: "قصص الورعين",
            references: [
                { source: "حلية الأولياء", ref: "ج3 ص150" },
                { source: "إحياء علوم الدين", ref: "ج2 ص75" }
            ]
        },
        {
            title: "عفو الإمام علي عن قاتله",
            summary: "قصة عفوه عن ابن ملجم وهو على فراش الموت",
            content: `
                <h4>القصة:</h4>
                <p>عندما طُعِن الإمام علي بن أبي طالب رضي الله عنه، أُتيَ له بابن ملجم ليقتص منه، فقال علي: "إن عشت فالأمر لي، وإن مت فأطعموه من طعامكم واسقوه من شرابكم، فإن عشت نظرت في أمري وإن مت فاضربوه ضربة واحدة". فلما مات علي، نفذوا وصيته.</p>
                
                <h4>العبرة:</h4>
                <p>العفو عند المقدرة من أخلاق المؤمنين العظماء، وهو دليل على قوة الإيمان.</p>
                
                <h4>المراجع:</h4>
                <p>نهج البلاغة، تاريخ الطبري</p>
            `,
            lessons: ["العفو", "الحلم", "القصاص"],
            category: "قصص الصحابة",
            references: [
                { source: "نهج البلاغة", ref: "الخطبة 147" },
                { source: "تاريخ الطبري", ref: "ج4 ص150" }
            ]
        },
        {
            title: "صدق أبي بكر الصديق",
            summary: "قصة تصديقه للنبي ﷺ في حادثة الإسراء والمعراج",
            content: `
                <h4>القصة:</h4>
                <p>عندما أخبر النبي ﷺ قريشاً بأنه أسري به إلى المسجد الأقصى ثم عرج به إلى السماوات، كذبه المشركون وجاؤوا لأبي بكر قائلين: "هل تصدق أن صاحبك زعم أنه ذهب إلى بيت المقدس وعاد في ليلة؟" فقال أبو بكر دون تردد: "إن كان قال ذلك فقد صدق". فسُمي من يومها بالصديق.</p>
                
                <h4>العبرة:</h4>
                <p>الصدق مع الله ومع رسوله من أعظم الفضائل، وهو أساس الثقة في العلاقات.</p>
                
                <h4>المراجع:</h4>
                <p>صحيح البخاري، السيرة النبوية لابن هشام</p>
            `,
            lessons: ["الصدق", "الثقة", "الإيمان"],
            category: "قصص الصحابة",
            references: [
                { source: "صحيح البخاري", ref: "كتاب الصلاة، حديث 349" },
                { source: "السيرة النبوية", ref: "لابن هشام ج2 ص50" }
            ]
        },
        {
            title: "حياء عثمان بن عفان",
            summary: "قصة حياء الخليفة عثمان حتى تستحي منه الملائكة",
            content: `
                <h4>القصة:</h4>
                <p>قال النبي ﷺ: "ألا أستحي من رجل تستحي منه الملائكة". كان عثمان رضي الله عنه شديد الحياء، حتى إنه إذا اغتسل في بيته لا يخلع ثوبه كاملاً حياءً من الله. وكان الصحابة يذكرون أنه ما سبقهم عثمان بصيام ولا صلاة، لكنه كان أشدهم حياءً.</p>
                
                <h4>العبرة:</h4>
                <p>الحياء من الإيمان، وهو خلق كريم يمنع صاحبه من فعل القبيح.</p>
                
                <h4>المراجع:</h4>
                <p>صحيح مسلم، سنن الترمذي</p>
            `,
            lessons: ["الحياء", "الورع", "التقوى"],
            category: "قصص الصحابة",
            references: [
                { source: "صحيح مسلم", ref: "كتاب الفضائل، حديث 2401" },
                { source: "سنن الترمذي", ref: "كتاب المناقب، حديث 3700" }
            ]
        },
        {
            title: "بر الوالدين في الإسلام",
            summary: "قصة الرجل الذي حمل أمه إلى الحج",
            content: `
                <h4>القصة:</h4>
                <p>جاء رجل إلى النبي ﷺ وقال: "يا رسول الله، إن أمي شيخة كبيرة، وقد حملتها على ظهري حتى أديتها إلى الحج، فهل أديت حقها؟" فقال النبي ﷺ: "لا، ولا بطلقة واحدة من طلقاتها عند الولادة". ثم تلا قوله تعالى: "وَوَصَّيْنَا الْإِنسَانَ بِوَالِدَيْهِ حُسْنًا".</p>
                
                <h4>العبرة:</h4>
                <p>حق الوالدين عظيم لا يؤديه كاملاً إلا القليل، وهو من أحب الأعمال إلى الله.</p>
                
                <h4>المراجع:</h4>
                <p>شعب الإيمان للبيهقي، الأدب المفرد للبخاري</p>
            `,
            lessons: ["بر الوالدين", "الرحمة", "الحنان"],
            category: "قصص التابعين",
            references: [
                { source: "شعب الإيمان", ref: "ج6 ص150" },
                { source: "الأدب المفرد", ref: "باب بر الوالدين" }
            ]
        },
        {
            title: "إحسان النبي ﷺ إلى الجار",
            summary: "قصة النبي مع جاره اليهودي الذي كان يؤذيه",
            content: `
                <h4>القصة:</h4>
                <p>كان لرسول الله ﷺ جار يهودي يضع القمامة أمام بيته كل يوم. فذات يوم لم يجد القمامة، فسأل عن جاره فقيل له: "إنه مريض". فزاره النبي وعاده، فتعجب اليهودي وقال: "كيف تفعل هذا بي وأنا أفعل بك ما تفعل؟" فقال النبي ﷺ: "إنما الإسلام حسن الخلق". فأسلم اليهودي.</p>
                
                <h4>العبرة:</h4>
                <p>حسن الجوار من الإيمان، والإحسان إلى الجار من أسباب هدايته.</p>
                
                <h4>المراجع:</h4>
                <p>سنن البيهقي، السيرة النبوية لابن كثير</p>
            `,
            lessons: ["حسن الجوار", "الإحسان", "التسامح"],
            category: "قصص النبي ﷺ",
            references: [
                { source: "سنن البيهqi", ref: "ج10 ص250" },
                { source: "السيرة النبوية", ref: "لابن كثير ج3 ص150" }
            ]
        }
    ];

    function displayStories(storiesToShow) {
        storiesGrid.innerHTML = '';
        
        storiesToShow.forEach(story => {
            const storyCard = document.createElement('div');
            storyCard.className = 'story-card';
            
            storyCard.innerHTML = `
                <h3>${story.title}</h3>
                <div class="story-summary">${story.summary}</div>
                <div class="story-content">
                    ${story.content}
                    <div class="story-references">
                        <strong>المصادر والمراجع:</strong>
                        <ul>
                            ${story.references.map(ref => 
                                `<li><span class="ref-source">${ref.source}:</span> ${ref.ref}</li>`
                            ).join('')}
                        </ul>
                    </div>
                </div>
                <div class="story-lessons">
                    <strong>الدلالات:</strong>
                    ${story.lessons.map(lesson => `<span class="lesson-tag">${lesson}</span>`).join('')}
                </div>
                <div class="story-category">${story.category}</div>
            `;
            
            const summary = storyCard.querySelector('.story-summary');
            const content = storyCard.querySelector('.story-content');
            
            storyCard.addEventListener('mouseenter', function() {
                summary.style.display = 'none';
                content.style.display = 'block';
                this.style.height = 'auto';
                this.style.zIndex = '10';
            });
            
            storyCard.addEventListener('mouseleave', function() {
                summary.style.display = 'block';
                content.style.display = 'none';
                this.style.height = '220px';
                this.style.zIndex = '1';
            });
            
            storiesGrid.appendChild(storyCard);
        });
    }

    // عرض القصص عند تحميل الصفحة
    displayStories(stories);
});